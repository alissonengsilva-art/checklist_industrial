{% extends "base.html" %}
{% block content %}

<main class="container historico-page">

  <!-- üîπ T√çTULO CENTRALIZADO -->
  <div class="title-left">
    <img src="/static/icons/hitorico.png" alt="Checklist" class="icon-img">
    <h1>Hist√≥rico de Altera√ß√µes</h1>
  </div>

  <!-- üîπ DESCRI√á√ÉO E BOT√ÉO -->
  <p class="descricao">
    Acompanhe todas as mudan√ßas de status registradas.
  </p>

  {% if equipamento_id %}
  <a href="/historico" class="btn-voltar">‚¨ÖÔ∏è Ver todos</a>
  {% endif %}

  <!-- üîπ FORMUL√ÅRIO DE FILTROS -->
  <form method="get" class="filtros-form">
    <div class="filtro-campo">
      <label for="data_inicial">Data inicial</label>
      <input type="date" id="data_inicial" name="data_inicial">
    </div>

    <div class="filtro-campo">
      <label for="data_final">Data final</label>
      <input type="date" id="data_final" name="data_final">
    </div>

    <div class="filtro-campo">
      <label for="tecnico">T√©cnico</label>
      <select id="tecnico" name="tecnico">
        <option value="">Todos</option>
        {% for tecnico in tecnicos %}
        <option value="{{ tecnico }}">{{ tecnico }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="filtro-campo">
      <label for="tipo">Tipo</label>
      <select id="tipo" name="tipo">
        <option value="">Todos</option>
        {% for tipo in tipos %}
        <option value="{{ tipo }}">{{ tipo }}</option>
        {% endfor %}
      </select>
    </div>

    <button type="submit" class="btn-filtrar">üîç Filtrar</button>
    <a href="/historico" class="btn-limpar">üßπ Limpar</a>
  </form>

  <!-- üîπ TABELA -->
  <table class="historico-tabela">
    <thead>
      <tr>
        <th>Data</th>
        <th>Equipamento</th>
        <th>Tipo</th>
        <th>Status Anterior</th>
        <th>Status Novo</th>
        <th>T√©cnico</th>
        <th>Observa√ß√£o</th>
      </tr>
    </thead>
<tbody>
  {% for h in historico %}
  <tr>
    <td>{{ h.data_modificacao.astimezone().strftime("%d/%m/%Y %H:%M") }}</td>
    <td><strong>{{ h.equipamento.nome_equipamento }}</strong></td>
    <td>{{ h.equipamento.tipo }}</td>

    <!-- üîπ STATUS ANTERIOR (colorido automaticamente) -->
    <td style="color: {{ 'green' if h.status_anterior == 'OK' else 'red' if h.status_anterior == 'NOK' else 'inherit' }}">
      {{ h.status_anterior or '‚Äî' }}
    </td>

    <!-- üîπ STATUS NOVO (colorido automaticamente) -->
    <td style="color: {{ 'green' if h.status_novo == 'OK' else 'red' if h.status_novo == 'NOK' else 'inherit' }}">
      {{ h.status_novo or '‚Äî' }}
    </td>

    <td>{{ h.tecnico or '‚Äî' }}</td>
    <td>{{ h.observacao or '' }}</td>
  </tr>
  {% endfor %}
</tbody>

  </table>
<!-- ====== PAGINA√á√ÉO ====== -->
<div class="paginacao">
  {% if pagina_atual > 1 %}
    <a href="?page={{ pagina_atual - 1 }}" class="btn-pag">‚¨ÖÔ∏è Anterior</a>
  {% endif %}

  <span>P√°gina {{ pagina_atual }} de {{ total_paginas }} ({{ total_registros }} registros)</span>

  {% if pagina_atual < total_paginas %}
    <a href="?page={{ pagina_atual + 1 }}" class="btn-pag">Pr√≥xima ‚û°Ô∏è</a>
  {% endif %}
</div>

</main>


{% endblock %}
