{% extends "base.html" %}
{% block content %}

<main class="container detalhes-page">

  <!-- üîπ Bot√£o de Voltar -->
  <div class="voltar-dashboard">
    <a href="/dashboard_status" class="btn-voltar">
      <img src="/static/icons/voltar.png" alt="" class="icon-back"> 
      ‚Üê Voltar ao Dashboard Status
    </a>
  </div>

  <h1 class="titulo-principal">üìò Detalhes - {{ tipo }}</h1>

  <!-- ====== CARDS DE STATUS ====== -->
  <section class="status-cards">
    <div class="card ok">
      <div class="icon"><img src="/static/icons/ok.png" alt="OK" class="icon-img"></div>
      <div class="info">
        <h3>OK</h3>
        <p class="value">{{ total_ok }}</p>
      </div>
    </div>

    <div class="card nok">
      <div class="icon"><img src="/static/icons/nok.png" alt="NOK" class="icon-img"></div>
      <div class="info">
        <h3>NOK</h3>
        <p class="value">{{ total_nok }}</p>
      </div>
    </div>

    <div class="card man">
      <div class="icon"><img src="/static/icons/manutencao.png" alt="Manuten√ß√£o" class="icon-img"></div>
      <div class="info">
        <h3>Manuten√ß√£o</h3>
        <p class="value">{{ total_man }}</p>
      </div>
    </div>
  </section>

  <!-- ====== M√âTRICA DE DISPONIBILIDADE ====== -->
  <section class="metricas">
    <h2>Disponibilidade Atual</h2>
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ disponibilidade }}%;"></div>
      </div>
      <div class="progress-text">
        {{ "%.1f" % disponibilidade }}%
      </div>
    </div>
  </section>

  <!-- ====== LISTA DE EQUIPAMENTOS ====== -->
  <section class="tabela-equipamentos">
    <h2>üìã Equipamentos do Tipo {{ tipo }}</h2>
    <div class="table-container">
      <table class="checklist-table">
        <thead>
          <tr>
            <th>Equipamento</th>
            <th>Status</th>
            <th>Observa√ß√£o</th>
            <th>T√©cnico</th>
            <th>Atualizado em</th>
          </tr>
        </thead>
        <tbody>
          {% for e in equipamentos %}
          <tr class="status-{{ e.status|lower }}">
            <td>{{ e.nome_equipamento }}</td>
            <td class="status-cell">
              {% if e.status.upper() == "OK" %}
                <span class="status-badge ok">OK</span>
              {% elif e.status.upper() == "NOK" %}
                <span class="status-badge nok">NOK</span>
              {% else %}
                <span class="status-badge man">Manuten√ß√£o</span>
              {% endif %}
            </td>
            <td>{{ e.observacao or '-' }}</td>
            <td>{{ e.tecnico or '-' }}</td>
            <td>{{ e.data_atualizacao.strftime('%d/%m/%Y %H:%M') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- ====== HIST√ìRICO DE MUDAN√áAS ====== -->
  <section class="historico">
    <h2>üïí Hist√≥rico de Altera√ß√µes</h2>
    <div class="table-container">
      <table class="checklist-table">
        <thead>
          <tr>
            <th>Equipamento</th>
            <th>Status Anterior</th>
            <th>Status Novo</th>
            <th>Observa√ß√£o</th>
            <th>T√©cnico</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          {% for h in historico %}
          <tr>
            <td>{{ h.equipamento.nome_equipamento if h.equipamento else h.equipamento_id }}</td>
            <td>{{ h.status_anterior }}</td>
            <td>{{ h.status_novo }}</td>
            <td>{{ h.observacao or '-' }}</td>
            <td>{{ h.tecnico or '-' }}</td>
            <td>{{ h.data_modificacao.strftime('%d/%m/%Y %H:%M') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

</main>

{% endblock %}
