{% extends "base.html" %}
{% block content %}

<form id="checklist-form" method="post" action="/salvar_main" class="checklist-form">
  <main class="container checklist-page">

    <!-- ====== T√çTULO ====== -->
    <div class="titulo-checklist-utilidades">
      <img src="/static/icons/checklist.png" alt="Checklist" class="icon-img">
      <h1>Checklist Utilidades</h1>
    </div>
    <p class="descricao">Preencha abaixo os dados do checklist das utilidades.</p>

    <!-- ====== CABE√áALHO ====== -->
    <section class="cabecalho-checklist">
      <div class="input-row">
        <div class="form-group">
          <label for="tecnico">T√©cnico:</label>
          <input type="text" id="tecnico" name="tecnico" required>
        </div>
        <div class="form-group">
          <label for="especialidade_tecnico">Especialidade do T√©cnico:</label>
          <input type="text" id="especialidade_tecnico" name="especialidade_tecnico">
        </div>
      </div>

      <div class="input-row">
        <div class="form-group">
          <label for="team_leader">Team Leader:</label>
          <input type="text" id="team_leader" name="team_leader">
        </div>
        <div class="form-group">
          <label for="especialidade_team_leader">Especialidade do Team Leader:</label>
          <input type="text" id="especialidade_team_leader" name="especialidade_team_leader">
        </div>
      </div>

      <div class="input-row">
        <div class="form-group">
          <label for="turno">Turno:</label>
          <select id="turno" name="turno">
            <option>1¬∞</option>
            <option>2¬∞</option>
            <option>3¬∞</option>
          </select>
        </div>
        <div class="form-group">
          <label for="tipo_turno">Tipo de Turno:</label>
          <select id="tipo_turno" name="tipo_turno">
            <option>Produtivo</option>
            <option>Manuten√ß√£o</option>
          </select>
        </div>
      </div>
    </section>

    <!-- ====== ABAS ====== -->
    <div class="abas-container">
      <button type="button" class="aba-btn active" data-aba="main">Main Plant</button>
      <button type="button" class="aba-btn" data-aba="supplier">Supplier Park</button>
    </div>
    <p class="descricao">Selecione aqui os equipamentos que est√£o operando agora.</p>
    <!-- ====== MAIN PLANT ====== -->
    <div id="aba-main" class="aba-conteudo ativo">
      <!-- ====== STATUS ATUAL DOS EQUIPAMENTOS ====== -->
<section class="equipamentos-container">
  <h2>‚öôÔ∏è Status Atual dos Equipamentos</h2>

  <!-- ===== TORRES ===== -->
  <div class="equipamento-grupo">
    <h3>Torres</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 13) %}
      <label class="equipamento-item">
        <input type="checkbox" name="torre_{{ i }}">
        <span>Torre {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>

  <!-- ===== BOMBAS DE RESFRIAMENTO (BAC) ===== -->
  <div class="equipamento-grupo">
    <h3>Bombas de Resfriamento</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 11) %}
      <label class="equipamento-item">
        <input type="checkbox" name="bac_{{ i }}">
        <span>BAC {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>

  <!-- ===== BOMBAS DE √ÅGUA GELADA (BAG) ===== -->
  <div class="equipamento-grupo">
    <h3>Bombas √Ågua Gelada</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 10) %}
      <label class="equipamento-item">
        <input type="checkbox" name="bag_{{ i }}">
        <span>BAG {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>

  <!-- ===== COMPRESSORES ===== -->
  <div class="equipamento-grupo">
    <h3>Compressores</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 8) %}
      <label class="equipamento-item">
        <input type="checkbox" name="cp_{{ i }}">
        <span>CP {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>

  <!-- ===== CHILLER ===== -->
  <div class="equipamento-grupo">
    <h3>Chillers</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 10) %}
      <label class="equipamento-item">
        <input type="checkbox" name="chiller_{{ i }}">
        <span>Chiller {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>
  <!-- ===== SECADOR ===== -->
  <div class="equipamento-grupo">
    <h3>Secadores</h3>
    <div class="equipamentos-grid">
      {% for i in range(1, 4) %}
      <label class="equipamento-item">
        <input type="checkbox" name="secador{{ i }}">
        <span>Secador {{ "%02d"|format(i) }}</span>
      </label>
      {% endfor %}
    </div>
  </div>
</section>



      {% for nome_grupo, itens in grupos_main.items() %}
      <section class="grupo-checklist">
        <h2>{{ nome_grupo }}</h2>
        <table class="checklist-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Descri√ß√£o</th>
              <th>Unid.</th>
              <th>Min</th>
              <th>M√°x</th>
              <th>Valor</th>
              <th>OK</th>
              <th>NOK</th>
              <th>Coment√°rios</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ item.descricao }}</td>
              <td>{{ item.unidade }}</td>
              <td>{{ item.valor_min }}</td>
              <td>{{ item.valor_max }}</td>
<td>
  <input 
      type="text"
      name="valor_{{ item.id }}"
      pattern="^\d*([.,]\d+)?$"
      oninvalid="this.setCustomValidity('Digite um n√∫mero v√°lido (10, 10.5 ou 10,5). Deixe em branco se n√£o houver valor.')"
      oninput="this.setCustomValidity('')"
  >
</td>
              <td><input type="checkbox" name="ok_{{ item.id }}"></td>
              <td><input type="checkbox" name="nok_{{ item.id }}"></td>
              <td><input type="text" name="coment_{{ item.id }}" placeholder="Observa√ß√µes..."></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% endfor %}
    </div>

    <!-- ====== SUPPLIER PARK ====== -->
    <div id="aba-supplier" class="aba-conteudo">
      {% for nome_grupo, itens in grupos_supplier.items() %}
      <section class="grupo-checklist">
        <h2>{{ nome_grupo }}</h2>
        <table class="checklist-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Descri√ß√£o</th>
              <th>Unid.</th>
              <th>Min</th>
              <th>M√°x</th>
              <th>Valor</th>
              <th>OK</th>
              <th>NOK</th>
              <th>Coment√°rios</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ item.descricao }}</td>
              <td>{{ item.unidade }}</td>
              <td>{{ item.valor_min }}</td>
              <td>{{ item.valor_max }}</td>
              <td>
  <input 
      type="text"
      name="valor_{{ item.id }}"
      pattern="^\d*([.,]\d+)?$"
      oninvalid="this.setCustomValidity('Digite um n√∫mero v√°lido (10, 10.5 ou 10,5). Deixe em branco se n√£o houver valor.')"
      oninput="this.setCustomValidity('')"
  >
</td>
              <td><input type="checkbox" name="ok_{{ item.id }}"></td>
              <td><input type="checkbox" name="nok_{{ item.id }}"></td>
              <td><input type="text" name="coment_{{ item.id }}" placeholder="Observa√ß√µes..."></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
      {% endfor %}
    </div>

    <!-- ====== BOT√ÉO SALVAR ====== -->
    <div style="text-align:center; margin-top:25px;">
      <button type="submit" id="btnSalvar" class="btn-primary">üíæ Salvar Checklist</button>
    </div>

  </main>
</form>

<!-- ====== SCRIPT DE ABAS ====== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("checklist-form");
  const abas = document.querySelectorAll(".aba-btn");
  const conteudos = document.querySelectorAll(".aba-conteudo");

  abas.forEach(btn => {
    btn.addEventListener("click", () => {
      // Alterna bot√£o ativo
      abas.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // Alterna conte√∫do vis√≠vel
      conteudos.forEach(div => div.classList.remove("ativo"));
      document.getElementById(`aba-${btn.dataset.aba}`).classList.add("ativo");

      // Define a rota correta
      form.action = btn.dataset.aba === "main" ? "/salvar_main" : "/salvar_supplier";
    });
  });
});
</script>

<!-- ====== CSS LOCAL DE ABAS (garante exibi√ß√£o correta) ====== -->
<style>
.equipamentos-container {
  width: 100%;
  margin: 10px auto;
  font-family: "Segoe UI", Arial, sans-serif;
}

.equipamentos-container h2 {
  color: #243881;
  font-size: 18px;
  margin-bottom: 8px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 6px;
  border-bottom: 2px solid #243881;
  padding-bottom: 3px;
}

/* ===== GRUPOS COMPACTOS ===== */
.equipamento-grupo {
  margin-bottom: 8px;
  padding: 4px 10px;
  border-left: 4px solid #243881;       /* mant√©m a borda lateral azul */
  border-bottom: 2px solid #243881;     /* üîπ linha mais espessa entre blocos */
  border-radius: 6px;
  background-color: #fafbff;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}


/* ===== T√çTULOS ===== */
.equipamento-grupo h3 {
  color: #243881;
  margin-bottom: 5px;
  font-size: 13.5px;
  font-weight: 700;
  text-transform: uppercase;
  border-bottom: 1px solid #ccd0f5;
  padding-bottom: 2px;
}

/* ===== GRID ===== */
.equipamentos-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
  gap: 4px 6px;
  margin-top: 4px;
}

/* ===== BOT√ïES COMPACTOS ===== */
.equipamento-item {
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #cfd3f0;
  border-radius: 8px;
  background-color: #eef1fd;
  cursor: pointer;
  font-weight: 600;
  color: #243881;
  padding: 1px 0;
  font-size: 10.5px;
  transition: all 0.15s ease-in-out;
  min-height: 18px;
}

/* Hover */
.equipamento-item:hover {
  background-color: #d9defc;
  transform: translateY(-1px);
}

/* Oculta o checkbox original */
.equipamento-item input[type="checkbox"] {
  display: none;
}

/* Texto interno */
.equipamento-item span {
  user-select: none;
  text-align: center;
  width: 100%;
}

/* Selecionado (verde OK) */
.equipamento-item input[type="checkbox"]:checked + span {
  background-color: #4CAF50;
  color: white;
  width: 100%;
  height: 100%;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15);
}

/* ===== RESPONSIVO ===== */
@media (max-width: 768px) {
  .equipamentos-grid {
    grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
    gap: 4px;
  }
}
</style>


{% endblock %}
