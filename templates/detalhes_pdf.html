<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Relat√≥rio Checklist</title>
  <style>
  /* ======= AJUSTE DE FORMATA√á√ÉO DO PDF ======= */
  body {
    font-family: Arial, sans-serif;
    font-size: 12px;
    color: #000;
    margin: 10px 25px;
  }

  h1, h2, h3 {
    margin: 4px 0;
  }

  h1 {
    font-size: 18px;
    color: #1a1a1a;
  }

  h2 {
    font-size: 14px;
    color: #0a0a0a;
    margin-top: 15px;
    border-bottom: 2px solid #1a2a6c;
    padding-bottom: 3px;
  }

  p {
    margin: 2px 0;
    line-height: 1.2;
  }

  /* ======= TABELA ======= */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
  }

  th, td {
    border: 1px solid #444;
    padding: 1px 2px;
    text-align: center;
    font-size: 9.5px;
    line-height: 1;
  }

  th {
    background-color: #0f2453;
    color: white;
    font-weight: bold;
  }

  /* ===== CABE√áALHO ===== */
  .header {
    margin-bottom: 10px;
  }

  .header-top {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .titulo {
    font-size: 16px;
    font-weight: bold;
    color: #0f2453;
    margin: 0;
    text-align: center;
    flex: 1;
  }

  .logo {
    position: absolute;
    right: 0;
    width: 120px;
    opacity: 1;
  }

  .info {
    font-size: 11px;
    color: #1a1a1a;
    line-height: 1.3;
    margin-top: 8px;
    margin-bottom: 0;
    text-align: left;
  }

  .info p {
    margin: 1px 0;
  }

  .header-line {
    border-top: 3px solid #0f2453;
    margin: 5px 0 10px 0;
  }
  </style>
</head>

<body>

<!-- ===== CABE√áALHO ===== -->
<div class="header">
  <div class="header-top">
    <h1 class="titulo">Detalhes do Checklist - Energy Center</h1>
    <img src="{{ logo_path }}" class="logo" alt="Stellantis">
  </div>

  <div class="info">
    <p><strong>T√©cnico:</strong> {{ checklist.tecnico }} | <strong>Especialidade:</strong> {{ checklist.especialidade_tecnico }}</p>
    <p><strong>L√≠der:</strong> {{ checklist.team_leader }} | <strong>Esp. L√≠der:</strong> {{ checklist.especialidade_team_leader }}</p>
    <p><strong>Turno:</strong> {{ checklist.turno }} | <strong>Data:</strong> {{ checklist.data_criacao.strftime('%d/%m/%Y %H:%M') }}</p>
  </div>
</div>

<div class="header-line"></div>

{% if equipamentos_operando %}
  <h2 class="titulo-status">‚ö°Status Atual dos Equipamentos</h2>

  <table class="tabela-status-equip">
    <thead>
      <tr>
        <th>Item</th>
        <th>Equipamentos Operando</th>
      </tr>
    </thead>
    <tbody>
      {% for tipo, grupo in {
        'Torres': equipamentos_operando | selectattr('tipo', 'equalto', 'Torre') | list,
        'Bombas de Resfriamento': equipamentos_operando | selectattr('tipo', 'equalto', 'BAC') | list,
        'Bombas √Ågua Gelada': equipamentos_operando | selectattr('tipo', 'equalto', 'BAG') | list,
        'Compressores': equipamentos_operando | selectattr('tipo', 'equalto', 'Compressor') | list,
        'Chillers': equipamentos_operando | selectattr('tipo', 'equalto', 'Chiller') | list
      }.items() %}
      {% if grupo %}
      <tr>
        <td class="tipo-equip">{{ tipo }}</td>
        <td class="desc-equip">
          {% for eq in grupo %}
            {{ eq.nome_equipamento }}{% if not loop.last %} - {% endif %}
          {% endfor %}
        </td>
      </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>
{% endif %}






<!-- ===== FUN√á√ÉO PARA RENDERIZAR UMA TABELA ===== -->
{% macro tabela(itens) %}
<table>
  <thead>
    <tr>
      <th>Item</th><th>Descri√ß√£o</th><th>Unid.</th>
      <th>Min</th><th>M√°x</th><th>Valor</th><th>OK</th><th>NOK</th><th>Coment√°rios</th>
    </tr>
  </thead>
  <tbody>
    {% for item in itens %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ item.descricao }}</td>
      <td>{{ item.unidade or '-' }}</td>
      <td>{{ item.valor_min or '-' }}</td>
      <td>{{ item.valor_max or '-' }}</td>
      <td>{{ item.valor_registrado or '-' }}</td>
      <td>{{ '‚úîÔ∏è' if item.status_ok else '' }}</td>
      <td>{{ '‚ùå' if item.status_ok == False else '' }}</td>
      <td>{{ item.comentario or '' }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endmacro %}

<!-- ===== MAIN PLANT ===== -->
{% if grupos["Ar Comprimido"] %}
  <h2>üïì Ar Comprimido</h2>
  {{ tabela(grupos["Ar Comprimido"]) }}
{% endif %}

{% if grupos["√Ågua de Resfriamento"] %}
  <h2>üíß √Ågua de Resfriamento</h2>
  {{ tabela(grupos["√Ågua de Resfriamento"]) }}
{% endif %}

{% if grupos["√Ågua Gelada"] %}
  <h2>‚ùÑÔ∏è √Ågua Gelada</h2>
  {{ tabela(grupos["√Ågua Gelada"]) }}
{% endif %}

{% if grupos["Climatiza√ß√£o Funilaria"] %}
  <h2>üåÄ Climatiza√ß√£o Funilaria</h2>
  {{ tabela(grupos["Climatiza√ß√£o Funilaria"]) }}
{% endif %}

{% if grupos["Climatiza√ß√£o Montagem"] %}
  <h2>üåÄ Climatiza√ß√£o Montagem</h2>
  {{ tabela(grupos["Climatiza√ß√£o Montagem"]) }}
{% endif %}

{% if grupos["Climatiza√ß√£o Communication"] %}
  <h2>üåÄ Climatiza√ß√£o Communication</h2>
  {{ tabela(grupos["Climatiza√ß√£o Communication"]) }}
{% endif %}

<!-- ===== SUPPLIER PARK ===== -->
{% if grupos["denso"] %}
  <h2>üè¢ DENSO - Supplier Park</h2>
  {{ tabela(grupos["denso"]) }}
{% endif %}

{% if grupos["mmh"] %}
  <h2>üè¢ MMH - Supplier Park</h2>
  {{ tabela(grupos["mmh"]) }}
{% endif %}

{% if grupos["pmc"] %}
  <h2>üè¢ PMC - Supplier Park</h2>
  {{ tabela(grupos["pmc"]) }}
{% endif %}

{% if grupos["tiberina"] %}
  <h2>üè¢ TIBERINA - Supplier Park</h2>
  {{ tabela(grupos["tiberina"]) }}
{% endif %}

{% if grupos["revest"] %}
  <h2>üè¢ REVESTCOAT - Supplier Park</h2>
  {{ tabela(grupos["revest"]) }}
{% endif %}

</body>
</html>
