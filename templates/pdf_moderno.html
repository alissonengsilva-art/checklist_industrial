<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="{{ css_path }}">
</head>
<body>

<!-- ===== CABEÇALHO ===== -->
<!-- ===== CABEÇALHO ===== -->
<div class="topbar">
    <img src="{{ logo_path }}" class="logo-st">

    <h1 class="topbar-title">Checklist Utilidades</h1>

    <p class="topbar-subtitle">
        Localização —
        {% if tipo_checklist == "main" %}
            Main Plant
        {% else %}
            Supplier Park
        {% endif %}
    </p>

    <p class="topbar-info">
        <strong>Técnico:</strong> {{ checklist.tecnico }} 
        <!-- <strong>Especialidade:</strong> {{ checklist.especialidade_tecnico }} -->
    </p>

    <p class="topbar-info">
        <strong>Team Leader:</strong> {{ checklist.team_leader }} 
        <!-- <strong>Especialidade TL:</strong> {{ checklist.especialidade_team_leader }} -->
    </p>

    <p class="topbar-info">
        <strong>Turno:</strong> {{ checklist.turno }} |
        <strong>Tipo de Turno:</strong> {{ checklist.tipo_turno }} |
        <strong>Data:</strong> {{ checklist.data_criacao.strftime('%d/%m/%Y %H:%M') }}
    </p>
</div>



<!-- ===== STATUS ATUAL ===== -->
{% if equipamentos_operando %}
<h2 class="section-title">
    <img src="{{ icon_path }}"> Status Atual dos Equipamentos
</h2>

<table class="status-table">
    <thead>
        <tr>
            <th>#</th>
            <th>Item</th>
            <th>Equipamentos Operando</th>
        </tr>
    </thead>
    <tbody>
    {% set idx = 1 %}
    
    {% for tipo, grupo in {
        'Torres': equipamentos_operando | selectattr('tipo', 'equalto', 'Torre') | list,
        'Bombas BAC': equipamentos_operando | selectattr('tipo', 'equalto', 'BAC') | list,
        'Bombas BAG': equipamentos_operando | selectattr('tipo', 'equalto', 'BAG') | list,
        'Compressores': equipamentos_operando | selectattr('tipo', 'equalto', 'Compressor') | list,
        'Chillers': equipamentos_operando | selectattr('tipo', 'equalto', 'Chiller') | list
    }.items() %}
    
    {% if grupo %}
        <tr>
            <td>{{ idx }}</td>
            <td>{{ tipo }}</td>
            <td>
                {% for eq in grupo %}
                    {{ eq.nome_equipamento }}{% if not loop.last %} - {% endif %}
                {% endfor %}
            </td>
        </tr>
        {% set idx = idx + 1 %}
    {% endif %}
    
    {% endfor %}
    </tbody>
</table>
{% endif %}




<!-- ===== FUNÇÃO TABELA ===== -->
{% macro tabela(itens) %}
<table>
    <thead>
        <tr>
            <th>#</th>
            <th>Descrição</th>
            <th>Unid.</th>
            <th>Min</th>
            <th>Máx</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Comentários</th>
        </tr>
    </thead>
    <tbody>
    {% for item in itens %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ item.descricao }}</td>
            <td>{{ item.unidade or '-' }}</td>
            <td>{{ item.valor_min or '-' }}</td>
            <td>{{ item.valor_max or '-' }}</td>
            <td>{{ item.valor_registrado or '-' }}</td>
            <td>
                {% if item.status_ok is sameas true %}
                    <img class="icon-status" src="{{ ok_path }}">
                {% elif item.status_ok is sameas false %}
                    <img class="icon-status" src="{{ nok_path }}">
                {% endif %}
            </td>
            <td>{{ item.comentario or '' }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endmacro %}


<!-- ===== GRUPOS ===== -->
{% for nome, itens in grupos.items() %}
{% if itens %}
<h2 class="section-title"><img src="{{ icon_path }}"> {{ nome }}</h2>
{{ tabela(itens) }}
{% endif %}
{% endfor %}

<!-- ===== RODAPÉ ===== -->
<div class="footer">
    Gerado pelo Sistema Energy Center • Stellantis Goiana • {{ now().strftime('%d/%m/%Y') }}
</div>

</body>
</html>
